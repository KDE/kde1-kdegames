VERSION=1.02

# @CXXFLAGS@     : is set to -g -Wall (when debuging) or -O2 -Wall (when not)
# @all_includes@ : is set to all needed include paths for QT, KDE and X11
# -I.. 	         : needed for config.h
CXXFLAGS= @CXXFLAGS@ @all_includes@ -DHAVE_CONFIG_H -I.. \
	-finline-functions

# @LDFLAGS@    : is set to -s (when not debuging) for stripping
# @all_libra.@ : is set to all needed libraries paths for QT, KDE and X11
# you need also @LIBSOCKET@, if you link with -lkfm
LDFLAGS	= @LDFLAGS@ @all_libraries@ -lkdecore -lkdeui -lqt -lX11 \
	-lXext

# both are clear, I think
CXX     = @CXX@
MOC   	= @MOC@

############# INSTALL #################

install = @INSTALL@
INSTALL = $(install) -m 0755
INSTALL_DATA = $(install) -m 0644
INSTALL_DIR = $(install) -d -m 0755
INSTALL_DIR_PRIVATE = $(install) -d -m 0700

prefix = @prefix@
KDEINC = $(prefix)/include
BINDIR = $(prefix)/bin
ICONDIR = $(prefix)/share/icons
MINIDIR = $(prefix)/share/icons/mini
ENDOCDIR = $(prefix)/share/doc/HTML/en/$(TARGET)
DEDOCDIR = $(prefix)/share/doc/HTML/de/$(TARGET)
KDELNKDIR= $(prefix)/share/applnk/Games
TBDIR  = $(prefix)/share/apps/$(TARGET)/toolbar

########### File Formats ###########

.SUFFIXES: .cpp

.cpp.o:
	$(CXX) -c $(CXXFLAGS) $<

%.moc: %.h
	$(MOC) $< -o $@

########## Files #####################

OBJECTS =       Board.o Move.o BoardWidget.o AbTop.o kabalone.o Spy.o
SRCMETA =	Board.moc AbTop.moc BoardWidget.moc Spy.moc
TARGET	=	kabalone

######### build rules ################

all: $(TARGET)

Makefile: Makefile.in
	cd .. && CONFIG_FILES=kabalone/$@ CONFIG_HEADERS= $(SHELL) ./config.status

$(TARGET): $(SRCMETA) $(OBJECTS)
	$(CXX) $(OBJECTS) -o $(TARGET) $(LDFLAGS)

clean:
	rm -f *.o *.bak *.moc *~ *% #*
	rm -f $(SRCMETA) $(TARGET)

distclean: clean
	rm -f Makefile

tar: clean
	(rm -f Makefile; cd ..; tar czvf kabalone-$(VERSION).tgz kabalone)

install: all
	$(INSTALL_DIR) $(BINDIR)
	$(INSTALL) $(TARGET) $(BINDIR)
	$(INSTALL_DIR) $(ICONDIR)
	$(INSTALL_DATA) icon/kabalone.xpm $(ICONDIR)
	$(INSTALL_DIR) $(MINIDIR)
	$(INSTALL_DATA) icon/mini/kabalone.xpm $(MINIDIR)
	$(INSTALL_DIR) $(ENDOCDIR)
	$(INSTALL_DATA) html/index.html $(ENDOCDIR)
	$(INSTALL_DIR) $(DEDOCDIR)
	$(INSTALL_DATA) html/de/index.html $(DEDOCDIR)
	$(INSTALL_DIR) $(KDELNKDIR)
	$(INSTALL_DATA) kabalone.kdelnk $(KDELNKDIR)
	$(INSTALL_DIR) $(TBDIR)
	$(INSTALL_DATA) toolbar/*.xpm $(TBDIR)

uninstall:
	rm -f $(BINDIR)/$(TARGET)
	rm -f $(DOCDIR)/$(DOCS)

dep:
	makedepend -Y *.cpp

$(TARGET).po:
	xgettext --default-domain=$(TARGET) --keyword=translate *.cpp

createpo: $(TARGET).po
	mv $(TARGET).po po
	
updatepo: $(TARGET).po
	tupdate $(TARGET).po po/de/$(TARGET).po >de.po
	mv $(TARGET).po po
	mv de.po po/de/$(TARGET).po
	msgfmt po/de/$(TARGET).po
	mv messages po/de/$(TARGET).mo

	


# DO NOT DELETE
AbTop.o: AbTop.h Board.h Move.h BoardWidget.h Spy.h AbTop.moc
Board.o: Board.h Move.h Board.moc
BoardWidget.o: Board.h Move.h BoardWidget.h bitmaps/Arrow1 bitmaps/Arrow1Mask
BoardWidget.o: bitmaps/Arrow2 bitmaps/Arrow2Mask bitmaps/Arrow3
BoardWidget.o: bitmaps/Arrow3Mask bitmaps/Arrow4 bitmaps/Arrow4Mask
BoardWidget.o: bitmaps/Arrow5 bitmaps/Arrow5Mask bitmaps/Arrow6
BoardWidget.o: bitmaps/Arrow6Mask BoardWidget.moc
Move.o: Move.h
Spy.o: Spy.h Board.h Move.h BoardWidget.h Spy.moc
kabalone.o: AbTop.h Board.h Move.h BoardWidget.h Spy.h
